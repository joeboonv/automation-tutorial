<html>
  <head>
    <title>Ancient Temple of Ocypress</title>
    <style>
.image-container {
  position: relative;
  width: 1000px;
  height: 662px;
  display: flex;
  justify-content: center;
  margin: auto;
}

.fullImage {
  position: absolute;
  top: 0px;
  left: 0px;
  width: 1000px;
  padding: 0px;
  margin: 0px;
  border: none;
}

.backgroundImage {
  z-index: -1;
  background-color: black; 
}

.foregroundImage {
  z-index: 99;
}

.wheel {
  position: relative;
  left: 0px;
  top: 40px;
  width: 550px;
  height: 550px;
}

.swingingWheel {
  animation-name: rollFromLeftToRightAndBack;
  animation-duration: 6s;
  animation-delay: 2s;
  animation-iteration-count: 6;
  animation-timing-function: ease-in-out;
  animation-direction: alternate;
  animation-fill-mode: forwards;
  transform-origin: 50% -200%;
  rotate: -9deg;
}

.fallingWheel {
  animation-name: fallForwards;
  animation-duration: 1500ms;
  animation-iteration-count: 1;
  animation-timing-function: linear;
  animation-fill-mode: forwards;
  transform-origin: 0% 10%;
  rotate: 0deg;
}

@keyframes fallForwards {
  0%  { rotate: 0deg; top: 40px }
  50% { rotate: 0deg; top: 80px; left: 10px }
  100% { rotate: 8deg; top: 80px; left: 50px }
}

    </style>

    <style id="keyframesRoll">
      @keyframes rollFromLeftToRightAndBack {
        0%   { rotate: -9deg;  }
        100% { rotate: 9deg; }
      }
    </style>

    <script language="javascript">
      // TODO pause to show stone - otherwise it loads before the other images?
      // We can make the wheel much larger and swing it "from somewhere above the ceiling" 
      //   so it is like a pendulum, and blocks the door unless it lines up
      // OR Make it move more slowly, longer than Cypress timeout, then stop animating, then
      // carry on and block the door

      let right = true;
      let maxRotationDeg = 9;
      let rotationReductionStep = 3;
      let iterationCount = 0;
      let rightRotationDeg = -maxRotationDeg;
      let leftRotationDeg = maxRotationDeg;
      function reduceWheelAnimation() {
        iterationCount++;
        console.log(`Animation iteration count: ${iterationCount}`);
        var kf = document.getElementById('keyframesRoll');
        if (right) {
          rightRotationDeg += rotationReductionStep;
        } else {
          leftRotationDeg -= rotationReductionStep;
        }
        right = !right;
        
        kf.innerHTML = getRollKeyframes(rightRotationDeg, leftRotationDeg);
      };

      function getRollKeyframes(rightRotationDeg, leftRotationDeg) {
        return `@keyframes rollFromLeftToRightAndBack { 0% { rotate: ${rightRotationDeg}deg; } 100% { rotate: ${leftRotationDeg}deg; } }`;
      }

      function endOfWheelAnimation() {
        setTimeout(startFallAnimation, 2000);
      }

      function startFallAnimation() {
        const wheel = document.querySelector('.wheel');
        wheel.setAttribute('class', 'wheel fallingWheel');
      }

      function addListeners() {
        const wheel = document.querySelector('.wheel');
        wheel.addEventListener("animationiteration", reduceWheelAnimation);
        wheel.addEventListener("animationend", endOfWheelAnimation);
      }

      let hoverTempleCount = 0;
      function hoverTemple() {
        hoverTempleCount++;
        // document.getElementById('info').innerHTML = "hoverTemple " + hoverTempleCount;
      }

      // let hoverDoorCount = 0;
      function hoverDoor() {
        // hoverDoorCount++;
        // document.getElementById('info').innerHTML = "hoverDoor " + hoverDoorCount;
      }

      function openDoor(event) {
        if (isHuman()) {
          window.alert('You are too tall to fit into that small door. Please send CyBot in there.');
        } else {
          window.alert('Entering the ancient temple');
        }
        // document.getElementById('info').innerHTML = "openDoor " + event.x + " " + event.y;
        // window.alert("openDoor " + event.x + " " + event.y);
      }

      function isHuman() {
        return hoverTempleCount > 3 && !isCypressRunning();
      }

      function isCypressRunning() {
        return window.Cypress;
      }

    </script>
  </head>

  <body onload="javascript:addListeners();">
    <!-- <p id="info">Info</p>   -->

    <div class="image-container">
      <img
        src="img/r2-background.png"
        alt="Underground door"
        class="fullImage backgroundImage"
      />

      <img
        src="img/r2-wheel.gif"
        alt="rotating stone wheel showing the mayan calendar"
        class="wheel swingingWheel"
      />

      <img
        src="img/r2-foreground.png"
        alt="Underground foyer"
        class="fullImage foregroundImage"
      />

      <br/>
      <p>.</p>

    </div>
    
    <br/>
    <br/>
    <br/>
    <br/>
    
    <p>Photo by Arun Varadarajan on <a href="https://commons.wikimedia.org/wiki/Category:Large_Underground_Temple#/media/File:Underground_Siva_Temple.JPG">Wikimedia</a>.
      <a href="https://commons.wikimedia.org/wiki/File:Underground_Siva_Temple.JPG">Licence.</a>
    </p>
  </body>
</html>
